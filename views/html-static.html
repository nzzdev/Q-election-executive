<div class="q-item-container">
  <h3 class="s-q-item__title">{{title}}</h3>
  <Header subtitle='{{subtitle}}' isIntermediate='{{isIntermediate}}' updatedDate='{{updatedDate}}'/>
  <div class="q-election-executive">
    <MajorityInfo majority='{{majority}}' maxResult='{{candidatesInfo.maxResult}}' sortedCandidates='{{sortedCandidates}}' />
    <Candidates sortedCandidates='{{sortedCandidates}}' maxResult='{{candidatesInfo.maxResult}}' />
  </div>
  <Footer majority='{{majority}}' candidatesInfo='{{candidatesInfo}}' sources='{{sources}}' notes='{{notes}}' />
</div>

<script>
  import Header from './Header.html';
  import MajorityInfo from './MajorityInfo.html';
  import Candidates from './Candidates.html';
  import Footer from './Footer.html';

  export default {
    computed: {
      sortedCandidates: (candidates) => {
        return candidates.sort(function(candidateA, candidateB) {
          if ((candidateA.votes === undefined && candidateB.votes === undefined) || candidateA.votes === candidateB.votes) {
            return 0;
          }
          if ((candidateA.votes === undefined && candidateB.votes !== undefined) || (candidateA.votes < candidateB.votes)) {
            return 1;
          }
          return -1;
        })
      },
      candidatesInfo: (candidates, majority) => {
        let maxResult = 0;
        let countIsPrevious = 0;
        let countIsElected = 0;
        let countIsDropped = 0;
        candidates.forEach(candidate => {
          if(candidate.isPrevious) {
            countIsPrevious++;
            if (candidate.status === "not elected") {
              countIsDropped++ 
            }
          }
          if (candidate.status === "elected") {
            countIsElected++;
          }
          if (candidate.votes > maxResult) {
            maxResult = candidate.votes;
          }
        })
        let candidatesInfo = {
          maxResult: maxResult,
          isPrevious: countIsPrevious > 0,
          isElected: countIsElected > 0,
          isDropped: countIsDropped > 0
        };
        return candidatesInfo;
      }
    },

    components: {
      Header,
      MajorityInfo,
      Candidates,
      Footer
    }
  };
</script>

